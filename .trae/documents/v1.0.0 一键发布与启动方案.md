## 目标
- 打包发布 v1.0.0，使用户可：
  - 一键安装并启用（自动安装依赖、生成环境、后台启动前后端）。
  - 或解压后用一条指令直接启动服务（无需交互）。
- 保持与现有脚本一致的端口、日志与健康检查机制，符合项目“服务管理脚本”与“日志管理”规则。

## 前置要求
- 系统：Linux（bash、lsof、curl 可用）。
- Node.js ≥ 18，npm ≥ 10（`vite` 与 `tsx` 兼容）。
- 目录结构：前端 `frontend/`，后端 Node `backend-node/`。
- 现有脚本：`frontend/scripts/client-manager.sh`、`backend-node/scripts/server-manager.sh`、`scripts/pretty.sh`。

## 一键使用方式
- 一键安装启用：
  1. 解压包到目标目录。
  2. 运行 `./scripts/install.sh`（非交互式检查环境、安装依赖、生成 `.env`、创建日志目录）。
  3. 运行 `./scripts/release.sh start`（后台启动：后端 + 前端）。
- 解压后一条指令启动：
  - 直接运行 `./scripts/release.sh start`（首次运行将自动提醒或联动安装步骤）。

## 新增脚本与职责
- `scripts/install.sh`
  - 校验 `node`/`npm` 版本；创建 `frontend/logs`、`backend-node/logs`。
  - 在 `frontend`、`backend-node` 执行 `npm ci`（安装含 dev 依赖以支持 build/preview/tsc）。
  - 若缺失则生成 `.env`（例如 `NODE_ENV=production`、为后端生成随机 `JWT_SECRET`；保留端口默认范围）。
  - 输出下一步提示：`./scripts/release.sh start`。
- `scripts/release.sh`（统一一键入口，生产模式）
  - `start`：调用 `backend-node/scripts/server-manager.sh start` 与 `frontend/scripts/client-manager.sh start`，并行后台启动，打印 URL 与日志路径。
  - `stop`：调用两端 `stop`；`status`：聚合两端状态；`logs`：并排展示两端最近日志；`health`：汇总 200 检查。
  - `start:dev`：联动各自 `start:dev` 以便调试（可选）。
- `scripts/package-release.sh`
  - 生成 `dist/releases/scaffold-v1.0.0.tar.gz`：
    - 打包源代码与脚本，排除 `node_modules`、临时文件与构建产物。
    - 内含：`scripts/install.sh`、`scripts/release.sh`、`scripts/pretty.sh`、前后端目录与现有管理脚本、示例 `.env`。

## 与现有管理脚本的协同
- 前端：`client-manager.sh start` 会 `vite build` 后以 `vite preview` 后台运行，端口范围 `10100-10190`，日志在 `frontend/logs/frontend.log`。
- 后端：`server-manager.sh start` 会 `tsc` 编译后以 `node dist/server.js` 后台运行，端口范围 `10000-10090`，日志在 `backend-node/logs/backend.log`。
- `release.sh` 只做编排与汇总输出，不改动既有行为。

## 健康检查与日志
- 统一 `./scripts/release.sh health`：
  - 后端：请求 `http://localhost:<backend-port>/health` 期待 `200`。
  - 前端：请求 `http://localhost:<frontend-port>` 期待 `200`。
- 日志查看与聚合：`./scripts/release.sh logs`，分别 tail 两端日志；首次启动输出端口与日志路径。

## 版本与清单
- 版本号：保持 `frontend/package.json` 与 `backend-node/package.json` 为 `1.0.0`；新增顶层 `VERSION` 文件（内容 `1.0.0`）。
- 发布包包含：顶层 `README` 使用说明、`scripts/*`、`frontend/*`、`backend-node/*`、示例 `.env.example`，不包含 `node_modules`。

## 验证流程
- 安装后执行：
  - `./scripts/release.sh start` → 输出两个 URL 与 PID；
  - `./scripts/release.sh health` → 期望两个 `200`；
  - 注册/登录/改昵称流程自测前后端交互；
  - `./scripts/release.sh stop` → 端口关闭、PID 清理。
- 边界：端口占用自动顺延范围；环境缺失自动生成；多次启动幂等（PID/端口文件管理）。

## 交付物
- `scaffold-v1.0.0.tar.gz` 与使用说明（README 章节：安装、启动、停止、日志、健康、自启选项）。

如确认该方案，我将新增上述脚本、补充 README，完成打包与本地验证，并提供产物与使用说明。